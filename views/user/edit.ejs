<% layout('layouts/boilerplate') %>

<!-- user setting -->
<div class="bloc none l-bloc" id="bloc-13"
     style="background-image: url('/img/background/signup.jpg'); background-size: cover; background-position: center;">
    <div class="container bloc-lg-lg">
        <div class="row">
            <div class="col-sm-10 offset-sm-1 col-md-8 offset-md-2 col-lg-8 offset-lg-2">

                <div class="signup-card">
                    <h1 class="mb-4 text-center">Edit User Settings</h1>
                    <!-- Avatar Section -->
                    <div class="row">
                        <div class="col-lg-12 mt-5">
                            <h4 class="mb-4 text-lg-center">Update Profile Photo</h4>
                        </div>
                        <div class="text-lg-start col-lg-12 mb-lg-2">
                            <div class="form-group mb-3">
                                <div class="avatar-preview mb-4">
                                    <img id="avatar-large" class="avatar-large"
                                         src="<%= user.avatar %>"
                                         alt="Selected avatar"
                                    >
                                    <!--                                         src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751666550/placeholder-user_rbr3rs.png"-->
                                </div>
                                <div class="avatar-gallery mb-5 flex-wrap justify-center">
                                    <!--placeholder-->
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751666550/placeholder-user_cepxo6.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751666550/placeholder-user_rbr3rs.png"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar placeholder" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751666550/placeholder-user_rbr3rs.png">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661921/avatar-1_afstqh.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661915/avatar-1_rltonx.jpg"
                                             class="avatar-thumb selected img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 1" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661915/avatar-1_rltonx.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661915/avatar-2_v0ocxx.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661916/avatar-2_pcpiuc.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 2" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661916/avatar-2_pcpiuc.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661919/avatar-3_zl4icb.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661917/avatar-3_uge9uz.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 3" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661917/avatar-3_uge9uz.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661919/avatar-4_neysol.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661918/avatar-4_u7ekxu.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 4" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661918/avatar-4_u7ekxu.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661919/avatar-5_qee7yf.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661920/avatar-5_mhbem1.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 5" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661920/avatar-5_mhbem1.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661920/avatar-6_tw3vqo.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661917/avatar-6_yhpqaq.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 6" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661917/avatar-6_yhpqaq.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661920/avatar-7_vdf57x.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661916/avatar-7_nkwrzp.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 7" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661916/avatar-7_nkwrzp.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661917/avatar-8_bkjo79.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661921/avatar-8_qou6jc.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 8" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661921/avatar-8_qou6jc.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661920/avatar-9_x6rzar.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661921/avatar-9_bvbvnm.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 9" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661921/avatar-9_bvbvnm.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661919/avatar-10_snk6pw.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661915/avatar-10_whnfik.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 10" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661915/avatar-10_whnfik.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661919/avatar-11_nitawu.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661916/avatar-11_mfblhm.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 11" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661916/avatar-11_mfblhm.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661923/avatar-12_criweo.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661915/avatar-12_xua4xf.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 12" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661915/avatar-12_xua4xf.jpg">
                                    </picture>
                                    <picture>
                                        <source type="image/webp"
                                                srcset="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661920/avatar-13_m5pqgp.webp">
                                        <img src="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661917/avatar-13_nn8ore.jpg"
                                             class="avatar-thumb img-fluid rounded-circle shadow lazyload"
                                             alt="Avatar 13" width="64" height="64" style="object-fit:cover;"
                                             data-avatar="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751661917/avatar-13_nn8ore.jpg">
                                    </picture>
                                </div>
                            </div>
                        </div>
                        <form id="user-settings-form" action="/users/<%= user._id %>?_method=PUT" method="POST"
                              class="needs-validation" novalidate>
                            <input type="hidden" name="avatar" id="avatar-input"
                                   value="https://res.cloudinary.com/dbdbod1wt/image/upload/v1751666550/placeholder-user_rbr3rs.png">

                            <!-- Name and Username Fields -->
                            <div class="row mb-4">
                                <h4 class="text-center text-secondary mb-4">Profile Information</h4>
                                <div class="col-lg-6 mb-3">
                                    <label class="form-label" for="current_fullname">Current Full Name</label>
                                    <input id="current_fullname" class="form-control" name="current_fullname"
                                           value="<%= currentUser.fullname %>" disabled>
                                </div>
                                <div class="col-lg-6 mb-3">
                                    <label class="form-label" for="current_username">Current Username</label>
                                    <input id="current_username" class="form-control" name="current_username"
                                           value="<%= currentUser.username %>" disabled>
                                </div>
                                <div class="col-lg-6 mb-3">
                                    <label class="form-label" for="fullname">New Full Name</label>
                                    <input id="fullname" class="form-control" required name="fullname"
                                           placeholder="Enter new full name" minlength="2">
                                    <div class="invalid-feedback">Please enter your full name (min 2 characters)
                                    </div>
                                </div>
                                <div class="col-lg-6 mb-3">
                                    <label class="form-label" for="username">New Username</label>
                                    <input id="new_username" class="form-control" required name="username"
                                           placeholder="Enter new username" minlength="3">
                                    <div class="invalid-feedback">Please enter a username (min 3 characters)</div>
                                </div>
                            </div>

                            <!-- Email Section -->
                            <div class="mb-4 border-bottom pb-3">
                                <h4 class="text-center text-secondary mb-4">Email Settings</h4>
                                <div class="row">
                                    <div class="col-lg-12 mb-3">
                                        <label class="form-label" for="current_email">Current Email</label>
                                        <input id="current_email" class="form-control" name="current_email"
                                               value="<%= currentUser.email %>" disabled>
                                    </div>
                                    <div class="col-lg-12 mb-3">
                                        <label class="form-label" for="email">New Email Address</label>
                                        <input id="email" class="form-control" name="new_email" type="email"
                                               placeholder="Enter new email address" required>
                                        <div class="invalid-feedback">Please enter a valid email address</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Password Section -->
                            <div class="mb-4">
                                <h4 class="text-center text-secondary mb-4">Password Settings</h4>
                                <div class="row">
                                    <div class="col-lg-12 mb-3">
                                        <label class="form-label" for="current_password">Current Password</label>
                                        <!--                                        <input id="current_password" class="form-control" name="current_password"-->
                                        <!--                                               type="password" required minlength="8">-->
                                        <input id="current_password" class="form-control" name="current_password"
                                               type="password" placeholder="Current Password" minlength="8">

                                        <div class="invalid-feedback">Please enter your current password</div>
                                    </div>
                                    <div class="col-lg-6 mb-3">
                                        <label class="form-label" for="new_password">New Password</label>
                                        <input id="new_password" class="form-control" name="new_password"
                                               type="password" placeholder="New Password" minlength="6">

                                        <!--                                               pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$"-->
                                        <small class="text-muted">Minimum 6 characters</small>
                                        <div class="invalid-feedback">Password must meet requirements</div>
                                    </div>
                                    <div class="col-lg-6 mb-3">
                                        <label class="form-label" for="confirm_password">Confirm New
                                            Password</label>
                                        <input id="confirm_password" class="form-control" name="confirm_password"
                                               type="password">
                                        <div class="invalid-feedback">Passwords do not match</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button class="btn btn-secondary text-light w-100 shadow-sm mt-4" type="submit">
                                Save Changes
                            </button>
                        </form>
                        <!--
                        <hr class="my-4">
                        <div class="text-center">
                            <h4 class="mb-3 text-danger">Delete Account</h4>
                            <form id="delete-account-form" action="delete-account-url" method="POST"
                                  onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
                                <button type="submit" class="btn btn-danger w-100">Delete Account</button>
                            </form>
                        </div>
                        -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    // Avatar selection logic
    const thumbs = document.querySelectorAll('.avatar-thumb');
    const avatarLarge = document.getElementById('avatar-large');
    const avatarInput = document.getElementById('avatar-input');

    // Set initial selected avatar
    const currentAvatar = avatarLarge.src;
    thumbs.forEach(thumb => {
        if (thumb.dataset.avatar === currentAvatar) {
            thumb.classList.add('selected');
        }
    });

    // Handle avatar selection
    thumbs.forEach(thumb => {
        thumb.addEventListener('click', function () {
            thumbs.forEach(t => t.classList.remove('selected'));
            this.classList.add('selected');
            avatarLarge.src = this.dataset.avatar;
            avatarInput.value = this.dataset.avatar;
        });
    });
</script>